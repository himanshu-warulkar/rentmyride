<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Filter Listings - Rent My Ride</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 font-sans text-gray-800">

  <header class="bg-white shadow-md sticky top-0 z-10">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
        <img src="data:image/jpeg;base64,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" alt="Rent My Ride Logo" class="h-10 w-auto">
      <h1 class="text-xl font-bold text-red-600">Rent My Ride</h1>
      <div class="space-x-2">
        <button onclick="window.location.href='/listings'" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">All</button>
        <button onclick="window.location.href='/listings/my-listings'" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">My Listings</button>
        <button onclick="window.location.href='/listings/new'" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Create</button>
        <button onclick="window.location.href='/listings/search'" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded">Search</button>
        <button onclick="window.location.href='/listings/filter'" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">Filter</button>
        <button onclick="window.location.href='/listings/sort'" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded">Sort</button>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <h2 class="text-3xl font-semibold mb-6 text-center">Filter Listings</h2>
    
    <!-- Filter Form -->
    <div class="bg-white shadow-lg rounded-lg p-6 mb-8">
      <form method="GET" action="/listings/filter" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- Fuel Type -->
          <div>
            <label for="fuelType" class="block text-sm font-medium text-gray-700 mb-1">Fuel Type</label>
            <select id="fuelType" name="fuelType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
              <option value="all" <%= filterParams && filterParams.fuelType ? filterParams.fuelType : '' === 'all' || !filterParams && filterParams.fuelType ? filterParams.fuelType : '' ? 'selected' : '' %>>All</option>
              <option value="Petrol" <%= filterParams && filterParams.fuelType ? filterParams.fuelType : '' === 'Petrol' ? 'selected' : '' %>>Petrol</option>
              <option value="Diesel" <%= filterParams && filterParams.fuelType ? filterParams.fuelType : '' === 'Diesel' ? 'selected' : '' %>>Diesel</option>
              <option value="Electric" <%= filterParams && filterParams.fuelType ? filterParams.fuelType : '' === 'Electric' ? 'selected' : '' %>>Electric</option>
              <option value="Hybrid" <%= filterParams && filterParams.fuelType ? filterParams.fuelType : '' === 'Hybrid' ? 'selected' : '' %>>Hybrid</option>
            </select>
          </div>

          <!-- Transmission -->
          <div>
            <label for="transmission" class="block text-sm font-medium text-gray-700 mb-1">Transmission</label>
            <select id="transmission" name="transmission" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
              <option value="all" <%= filterParams && filterParams.transmission ? filterParams.transmission : '' === 'all' || !filterParams && filterParams.transmission ? filterParams.transmission : '' ? 'selected' : '' %>>All</option>
              <option value="Manual" <%= filterParams && filterParams.transmission ? filterParams.transmission : '' === 'Manual' ? 'selected' : '' %>>Manual</option>
              <option value="Automatic" <%= filterParams && filterParams.transmission ? filterParams.transmission : '' === 'Automatic' ? 'selected' : '' %>>Automatic</option>
            </select>
          </div>

          <!-- Vehicle Type -->
          <div>
            <label for="vehicleType" class="block text-sm font-medium text-gray-700 mb-1">Vehicle Type</label>
            <select id="vehicleType" name="vehicleType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
              <option value="all" <%= filterParams && filterParams.vehicleType ? filterParams.vehicleType : '' === 'all' || !filterParams && filterParams.vehicleType ? filterParams.vehicleType : '' ? 'selected' : '' %>>All</option>
              <option value="Car" <%= filterParams && filterParams.vehicleType ? filterParams.vehicleType : '' === 'Car' ? 'selected' : '' %>>Car</option>
              <option value="Truck" <%= filterParams && filterParams.vehicleType ? filterParams.vehicleType : '' === 'Truck' ? 'selected' : '' %>>Truck</option>
              <option value="Motorcycle" <%= filterParams && filterParams.vehicleType ? filterParams.vehicleType : '' === 'Motorcycle' ? 'selected' : '' %>>Motorcycle</option>
              <option value="Van" <%= filterParams && filterParams.vehicleType ? filterParams.vehicleType : '' === 'Van' ? 'selected' : '' %>>Van</option>
              <option value="SUV" <%= filterParams && filterParams.vehicleType ? filterParams.vehicleType : '' === 'SUV' ? 'selected' : '' %>>SUV</option>
              <option value="Bus" <%= filterParams && filterParams.vehicleType ? filterParams.vehicleType : '' === 'Bus' ? 'selected' : '' %>>Bus</option>
              <option value="Bicycle" <%= filterParams && filterParams.vehicleType ? filterParams.vehicleType : '' === 'Bicycle' ? 'selected' : '' %>>Bicycle</option>
            </select>
          </div>

          <!-- Price Range -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Price Range (â‚¹)</label>
            <div class="flex space-x-2">
              <input type="number" name="minPrice" value="<%= filterParams && filterParams.minPrice ? filterParams.minPrice : '' || '' %>" 
                     placeholder="Min" 
                     class="w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
              <input type="number" name="maxPrice" value="<%= filterParams && filterParams.maxPrice ? filterParams.maxPrice : '' || '' %>" 
                     placeholder="Max" 
                     class="w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
          </div>

          <!-- Seats -->
          <div>
            <label for="seats" class="block text-sm font-medium text-gray-700 mb-1">Number of Seats</label>
            <select id="seats" name="seats" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
              <option value="all" <%= filterParams && filterParams.seats ? filterParams.seats : '' === 'all' || !filterParams && filterParams.seats ? filterParams.seats : '' ? 'selected' : '' %>>All</option>
              <option value="1" <%= filterParams && filterParams.seats ? filterParams.seats : '' === '1' ? 'selected' : '' %>>1</option>
              <option value="2" <%= filterParams && filterParams.seats ? filterParams.seats : '' === '2' ? 'selected' : '' %>>2</option>
              <option value="4" <%= filterParams && filterParams.seats ? filterParams.seats : '' === '4' ? 'selected' : '' %>>4</option>
              <option value="5" <%= filterParams && filterParams.seats ? filterParams.seats : '' === '5' ? 'selected' : '' %>>5</option>
              <option value="7" <%= filterParams && filterParams.seats ? filterParams.seats : '' === '7' ? 'selected' : '' %>>7</option>
              <option value="9" <%= filterParams && filterParams.seats ? filterParams.seats : '' === '9' ? 'selected' : '' %>>9</option>
            </select>
          </div>

          <!-- Availability -->
          <div>
            <label for="availability" class="block text-sm font-medium text-gray-700 mb-1">Availability</label>
            <select id="availability" name="availability" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
              <option value="all" <%= filterParams && filterParams.availability ? filterParams.availability : '' === 'all' || !filterParams && filterParams.availability ? filterParams.availability : '' ? 'selected' : '' %>>All</option>
              <option value="true" <%= filterParams && filterParams.availability ? filterParams.availability : '' === 'true' ? 'selected' : '' %>>Available</option>
              <option value="false" <%= filterParams && filterParams.availability ? filterParams.availability : '' === 'false' ? 'selected' : '' %>>Not Available</option>
            </select>
          </div>
        </div>

        <div class="flex justify-center space-x-4 pt-4">
          <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-md font-medium">
            <i class="fas fa-filter mr-2"></i>Apply Filters
          </button>
          <a href="/listings/filter" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-md font-medium">
            <i class="fas fa-times mr-2"></i>Clear
          </a>
        </div>
      </form>
    </div>

    <!-- Filter Results -->
    <% if (allListings && allListings.length > 0) { %>
      <div class="mb-4">
        <h3 class="text-xl font-semibold text-gray-800">Filtered Results (<%= allListings.length %> found)</h3>
      </div>
      
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <% for(let listing of allListings) { %>
          <div class="bg-white shadow-lg rounded-lg overflow-hidden">
            <img src="<%= listing.image %>" alt="<%= listing.title %>" class="w-full h-48 object-cover">
            <div class="p-4">
              <h3 class="text-xl font-bold text-gray-800 mb-2"><%= listing.title %></h3>
              <p class="text-sm text-gray-600 mb-2"><%= listing.description %></p>
              <div class="flex justify-between items-center mb-2">
                <p class="text-lg font-semibold text-blue-600">&#8377;<%= listing.price %></p>
                <% if (listing.seats) { %>
                  <span class="text-sm text-gray-500"><i class="fas fa-users mr-1"></i><%= listing.seats %> seats</span>
                <% } %>
              </div>
              <% if (listing.fuelType || listing.transmission) { %>
                <div class="flex justify-between text-sm text-gray-500 mb-2">
                  <% if (listing.fuelType) { %>
                    <span><i class="fas fa-gas-pump mr-1"></i><%= listing.fuelType %></span>
                  <% } %>
                  <% if (listing.transmission) { %>
                    <span><i class="fas fa-cogs mr-1"></i><%= listing.transmission %></span>
                  <% } %>
                </div>
              <% } %>
              <% if (listing.vehicleType) { %>
                <p class="text-sm text-gray-500 mb-2"><i class="fas fa-car mr-1"></i><%= listing.vehicleType %></p>
              <% } %>
              <% if (listing.availability !== undefined) { %>
                <div class="mb-3">
                  <span class="inline-block px-2 py-1 text-xs rounded-full <%= listing.availability ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                    <%= listing.availability ? 'Available' : 'Not Available' %>
                  </span>
                </div>
              <% } %>
              <a href="/listings/<%= listing._id %>" class="inline-block w-full text-center text-white bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                View Details
              </a>
            </div>
          </div>
        <% } %>
      </div>
    <% } else if (filterParams && (filterParams.fuelType !== 'all' || filterParams.transmission !== 'all' || filterParams.vehicleType !== 'all' || filterParams.minPrice || filterParams.maxPrice || filterParams.seats !== 'all' || filterParams.availability !== 'all')) { %>
      <div class="text-center py-8">
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
          <i class="fas fa-filter text-yellow-500 text-4xl mb-4"></i>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">No Results Found</h3>
          <p class="text-gray-600">No listings match your filter criteria. Try adjusting your filters.</p>
        </div>
      </div>
    <% } else { %>
      <div class="text-center py-8">
        <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
          <i class="fas fa-filter text-purple-500 text-4xl mb-4"></i>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Apply Filters</h3>
          <p class="text-gray-600">Use the filter form above to narrow down your search results.</p>
        </div>
      </div>
    <% } %>
  </main>

  <footer class="text-center py-6 text-sm text-gray-500">
    &copy; <%= new Date().getFullYear() %> RentMyRide. All rights reserved.
  </footer>

</body>
</html>
